version: 1.0.{build}-{branch}
configuration: Release
branches:
  only:
    - master
    - develop
image: Visual Studio 2017
clone_folder: C:\Projects\Kritikos.Services
shallow_clone: true
environment:
  MSBUILDDISABLENODEREUSE: 1
matrix:
  fast_finish: true
cache:
  - packages
  - C:\Users\appveyor\.sonar\cache
clone_script:
- ps: >-
  if(-not $env:appveyor_pull_request_number) {
    git clone -q --branch=$env:appveyor_repo_branch https://github.com/$env:appveyor_repo_name.git $env:appveyor_build_folder
    git checkout -qf $env:appveyor_repo_commit
  } else {
    git clone -q https://github.com/$env:appveyor_repo_name.git $env:appveyor_build_folder
    git fetch -q origin +refs/pull/$env:appveyor_pull_request_number/merge:
    git checkout -qf FETCH_HEAD
  }
  git submodule update --init --recursive
install:
  - dotnet restore --packages packages
build:
  project: Kritikos.Services.sln
  parallel: true
  verbosity: minimal
